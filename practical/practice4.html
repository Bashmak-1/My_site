<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>HATOR Grid Keyboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/practice4_style.css">
</head>
<body>

    <div class="keyboard-case">
        
        <div class="column-left">
            
            <div class="section-f-keys">
                <div class="key key-esc" data-code="Escape">Esc</div>
                <div class="f-gap"></div> 
                <div class="f-block">
                    <div class="key" data-code="F1">F1</div><div class="key" data-code="F2">F2</div><div class="key" data-code="F3">F3</div><div class="key" data-code="F4">F4</div>
                </div>
                <div class="f-block">
                    <div class="key" data-code="F5">F5</div><div class="key" data-code="F6">F6</div><div class="key" data-code="F7">F7</div><div class="key" data-code="F8">F8</div>
                </div>
                <div class="f-block f-rblock">
                    <div class="key" data-code="F9">F9</div><div class="key" data-code="F10">F10</div><div class="key" data-code="F11">F11</div><div class="key" data-code="F12">F12</div>
                </div>
            </div>

            <div class="section-main">
                <div class="key" data-code="Backquote">`</div><div class="key" data-code="Digit1">1</div><div class="key" data-code="Digit2">2</div><div class="key" data-code="Digit3">3</div><div class="key" data-code="Digit4">4</div>
                <div class="key" data-code="Digit5">5</div><div class="key" data-code="Digit6">6</div><div class="key" data-code="Digit7">7</div><div class="key" data-code="Digit8">8</div><div class="key" data-code="Digit9">9</div>
                <div class="key" data-code="Digit0">0</div><div class="key" data-code="Minus">-</div><div class="key" data-code="Equal">=</div><div class="key key-backspace" data-code="Backspace">Bksp</div>

                <div class="key key-tab" data-code="Tab">Tab</div>
                <div class="key" data-code="KeyQ">Q</div><div class="key" data-code="KeyW">W</div><div class="key" data-code="KeyE">E</div><div class="key" data-code="KeyR">R</div><div class="key" data-code="KeyT">T</div>
                <div class="key" data-code="KeyY">Y</div><div class="key" data-code="KeyU">U</div><div class="key" data-code="KeyI">I</div><div class="key" data-code="KeyO">O</div><div class="key" data-code="KeyP">P</div>
                <div class="key" data-code="BracketLeft">[</div><div class="key" data-code="BracketRight">]</div><div class="key key-slash" data-code="Backslash">\</div>

                <div class="key key-caps" id="btn-caps" data-code="CapsLock">Caps</div>
                <div class="key" data-code="KeyA">A</div><div class="key" data-code="KeyS">S</div><div class="key" data-code="KeyD">D</div><div class="key" data-code="KeyF">F</div><div class="key" data-code="KeyG">G</div>
                <div class="key" data-code="KeyH">H</div><div class="key" data-code="KeyJ">J</div><div class="key" data-code="KeyK">K</div><div class="key" data-code="KeyL">L</div><div class="key" data-code="Semicolon">;</div>
                <div class="key" data-code="Quote">'</div><div class="key key-enter" data-code="Enter">Enter</div>

                <div class="key key-lshift" data-code="ShiftLeft">Shift</div>
                <div class="key" data-code="KeyZ">Z</div><div class="key" data-code="KeyX">X</div><div class="key" data-code="KeyC">C</div><div class="key" data-code="KeyV">V</div><div class="key" data-code="KeyB">B</div>
                <div class="key" data-code="KeyN">N</div><div class="key" data-code="KeyM">M</div><div class="key" data-code="Comma">,</div><div class="key" data-code="Period">.</div><div class="key" data-code="Slash">/</div>
                <div class="key key-rshift" data-code="ShiftRight">Shift</div>

                <div class="row-bottom">
                    <div class="key key-mod" data-code="ControlLeft">Ctrl</div>
                    <div class="key key-mod" data-code="MetaLeft">Win</div>
                    <div class="key key-mod" data-code="AltLeft">Alt</div>
                    <div class="key key-space" data-code="Space"></div>
                    <div class="key key-mod" data-code="AltRight">Alt</div>
                    <div class="key key-mod">Fn</div> <div class="key key-mod" data-code="ContextMenu">Ctx</div>
                    <div class="key key-mod" data-code="ControlRight">Ctrl</div>
                </div>
            </div>
        </div>

        <div class="column-middle">
            <div class="section-sys-top">
                <div class="key" data-code="PrintScreen">Prt</div>
                <div class="key key-scr" id="btn-scroll" data-code="ScrollLock">Scr</div>
                <div class="key" data-code="Pause">Pau</div>
            </div>

            <div class="section-sys-main">
                <div class="key" data-code="Insert">Ins</div><div class="key" data-code="Home">Hm</div><div class="key" data-code="PageUp">PgU</div>
                <div class="key" data-code="Delete">Del</div><div class="key" data-code="End">End</div><div class="key" data-code="PageDown">PgD</div>
            </div>

            <div class="section-arrows">
                <div class="empty"></div><div class="key" data-code="ArrowUp">↑</div><div class="empty"></div>
                <div class="key" data-code="ArrowLeft">←</div><div class="key" data-code="ArrowDown">↓</div><div class="key" data-code="ArrowRight">→</div>
            </div>
        </div>

        <div class="column-right">
             <div class="led-panel">
                <div class="led-group">
                    <div class="led-label">NUM</div>
                    <div class="led" id="led-num"></div>
                </div>
                <div class="led-group">
                    <div class="led-label">CAPS</div>
                    <div class="led" id="led-caps"></div>
                </div>
                <div class="led-group">
                    <div class="led-label">SCRL</div>
                    <div class="led" id="led-scroll"></div>
                </div>
             </div>
             
             <div class="section-numpad">
                <div class="key key-num" id="btn-num" data-code="NumLock">Num</div>
                <div class="key" data-code="NumpadDivide">/</div><div class="key" data-code="NumpadMultiply">*</div><div class="key" data-code="NumpadSubtract">-</div>
                <div class="key" data-code="Numpad7">7</div><div class="key" data-code="Numpad8">8</div><div class="key" data-code="Numpad9">9</div><div class="key key-plus" data-code="NumpadAdd">+</div>
                <div class="key" data-code="Numpad4">4</div><div class="key" data-code="Numpad5">5</div><div class="key" data-code="Numpad6">6</div>
                <div class="key" data-code="Numpad1">1</div><div class="key" data-code="Numpad2">2</div><div class="key" data-code="Numpad3">3</div><div class="key key-enter-num" data-code="NumpadEnter">Ent</div>
                <div class="key key-zero" data-code="Numpad0">0</div><div class="key" data-code="NumpadDecimal">.</div>
            </div>
        </div>

    </div>

    <div class="reference-container">
        <h3>Оригінал (Референс):</h3>
        <img src="images/hator-icefall-mecha-origin-red-linear-htk104ua-black.jpg" alt="Keyboard Reference">
    </div>

    <script>
        const btnNum = document.getElementById('btn-num');
        const btnCaps = document.getElementById('btn-caps');
        const btnScroll = document.getElementById('btn-scroll');
        const ledNum = document.getElementById('led-num');
        const ledCaps = document.getElementById('led-caps');
        const ledScroll = document.getElementById('led-scroll');

        // Функція для кліку мишкою по кнопках на екрані
        function toggleLed(ledElement) {
            ledElement.classList.toggle('active');
        }

        btnNum.addEventListener('click', () => toggleLed(ledNum));
        btnCaps.addEventListener('click', () => toggleLed(ledCaps));
        btnScroll.addEventListener('click', () => toggleLed(ledScroll));


        // === ЛОГІКА СИНХРОНІЗАЦІЇ З КЛАВІАТУРОЮ ===

        document.addEventListener('keydown', function(event) {
            const code = event.code; 
            const keyElement = document.querySelector(`.key[data-code="${code}"]`);

            // --- ВИПРАВЛЕННЯ ДЛЯ RIGHT ALT (AltGr) ---
            // Якщо прийшов сигнал AltRight, значить перед ним мілісекунду тому був ControlLeft.
            // Ми повинні знайти ControlLeft і вимкнути його, щоб він не світився.
            if (code === 'AltRight') {
                const leftCtrl = document.querySelector('.key[data-code="ControlLeft"]');
                if (leftCtrl) leftCtrl.classList.remove('pressed');
            }

            if (keyElement) {
                // Блокуємо дії браузера для спецклавіш (щоб Alt не відкривав меню, а Tab не перемикав фокус)
                // Але Win (Meta) блокувати не можна з міркувань безпеки ОС
                if (code !== 'F5' && code !== 'F12' && code !== 'MetaLeft') {
                    event.preventDefault();
                }

                keyElement.classList.add('pressed');

                // Синхронізація лампочок (Caps, Num, Scroll)
                if (code === 'CapsLock') toggleLockState(ledCaps, event.getModifierState("CapsLock"));
                if (code === 'NumLock') toggleLockState(ledNum, event.getModifierState("NumLock"));
                if (code === 'ScrollLock') toggleLockState(ledScroll, event.getModifierState("ScrollLock"));
            }
        });

        document.addEventListener('keyup', function(event) {
            const code = event.code;
            const keyElement = document.querySelector(`.key[data-code="${code}"]`);

            if (keyElement) {
                keyElement.classList.remove('pressed');
            }

            // Додаткова підстраховка для AltGr:
            // Коли відпускаємо AltRight, переконаємось, що ControlLeft теж не залип
            if (code === 'AltRight') {
                const leftCtrl = document.querySelector('.key[data-code="ControlLeft"]');
                if (leftCtrl) leftCtrl.classList.remove('pressed');
            }
        });

        // --- ВИПРАВЛЕННЯ "ЗАЛИПАННЯ" ПРИ ВТРАТІ ФОКУСУ ---
        // Якщо натиснути Win (відкриється меню Пуск) або Alt+Tab, браузер "забуває" віджати кнопку.
        // Ця подія спрацьовує, коли вікно втрачає активність, і скидає всі натиснуті кнопки.
        window.addEventListener('blur', function() {
            document.querySelectorAll('.key.pressed').forEach(key => {
                key.classList.remove('pressed');
            });
        });

        // Допоміжна функція для лампочок
        function toggleLockState(ledElement, isActive) {
            if (isActive) {
                ledElement.classList.add('active');
            } else {
                ledElement.classList.remove('active');
            }
        }
    </script>
</body>
</html>